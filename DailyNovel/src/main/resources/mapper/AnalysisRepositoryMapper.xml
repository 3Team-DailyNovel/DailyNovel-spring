<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.dailynovel.web.repository.FeelingRepository">
	<!-- 아래의 리졀트맵의 id값을 활용해서 select문의 resultMap에 넣어주면 된다. -->
	
	
	
	
	<select id="findAll" resultType="FeelingRank">
		SELECT f.name, f.img, count(d.feeling_id) as frequency
		FROM feeling f
		LEFT JOIN Diary d ON f.id = d.feeling_id AND d.member_id = 1
		group by f.name
		ORDER BY frequency DESC;
	</select>
	
	<select id="findTopRank" resultType="FeelingRank">
		SELECT f.name, f.img, count(d.feeling_id) as frequency, f.description
		FROM feeling f
		inner JOIN Diary d ON f.id = d.feeling_id AND d.member_id = 1
		group by f.name
		ORDER BY frequency DESC
	</select>
	
	<select id="findRank" resultType="FeelingRank">
		SELECT f.img, f.name, COUNT(d.feeling_id) as frequency, DENSE_RANK() OVER (ORDER BY COUNT(d.feeling_id) DESC) as ranking
		FROM Diary d
		INNER JOIN feeling f ON f.id = d.feeling_id
		WHERE d.member_id = 1
		GROUP BY f.id
		ORDER BY frequency DESC
		LIMIT 1,4;
	</select>
	


</mapper>